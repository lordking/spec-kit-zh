---
description: 从交互式或提供的原则输入创建或更新项目宪章，确保所有依赖模板保持同步。
handoffs:
  - label: 构建规格
    agent: speckit.specify
    prompt: 基于更新后的宪章实现功能规格。我想构建...
---

## 用户输入

```text
$ARGUMENTS
```

在进行之前，你**必须**考虑用户输入（如果不为空）。

## 概要

你正在更新位于 `/memory/constitution.md` 的项目宪章。此文件是一个模板，包含使用方括号作为占位符标记（例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）。你的工作是（a）收集/推导具体值，（b）精确填充模板，（c）将任何修改传播到依赖的工件中。

遵循如下执行流程：

1. 加载现有位于 `/memory/constitution.md` 的宪章模板。
   - 识别 `[ALL_CAPS_IDENTIFIER]` 形式的每个占位符标记。
   **重要**：用户可能需要的原则比模板中使用的更少或更多。如果明确指定了数量，请遵循通用模板调整。并相应地更新文档。

2. 收集/推导占位符的值：
   - 如果用户输入（对话）提供了一个值，请使用它。
   - 否则从现有仓库上下文（README、文档、或者之前嵌入的宪章版本）中推断。
   - 对于治理日期：`RATIFICATION_DATE` 是原始采用日期（如果未知请询问或标记 TODO），`LAST_AMENDED_DATE` 如果修改则为今日，否则保留之前。
   - `CONSTITUTION_VERSION` 必须根据语义版本控制规则递增：
     - MAJOR：向后不兼容的治理/原则被删除或重新定义。
     - MINOR：新增原则/章节或指导内容实质性的扩展。
     - PATCH：澄清、措辞修正、拼写修复、非语义性改进。
   - 如果版本升级类型不明确，请在最终确定前提出理由。

3. 起草更新的宪章内容：
   - 用具体文本替换每个占位符（除了项目有意保留的暂时不定义的模板槽，不得保留方括号标记的占位符 - 对保留的占位符需明确说明理由）。
   - 保持标题层级结构，替换后可移除注释（除非注释仍提供明确指引）。
   - 确保每个原则/章节：简洁的名称、段落（或项目列表）捕获不可协商的规则。若规则不明确则需明确说明理由。
   - 确保治理章节列出修正程序、版本控制策略和合规审查期望。

4. 一致性传播检查（将之前的检查清单转换为主动验证）：
   - 读取 `/templates/plan-template.md` ，确保"宪章检查"的任何内容或规则与更新后的原则对齐。
   - 读取 `/templates/spec-template.md` ，确保范围/需求对齐 - 如果项目宪章添加/删除了强制性的章节或约束，则更新。
   - 读取 `/templates/tasks-template.md` ，确保任务分类反映新的或者删除的原则驱动的任务类型（例如可观测性、版本控制、测试规范）。
   - 读取 `/templates/commands/*.md` 中的每个命令文件（包括此文件），验证在需要通用指导时没有过时的引用（仅限于代理特定的名称如 CLAUDE）。
   - 读取任何运行时指导文档（例如`README.md`、`docs/quickstart.md`，或存在的代理指定的指导文件）。更新对更改原则的引用。

5. 生成同步影响报告（在更新后作为 HTML 评论前置在宪章文件顶部）：
   - 版本更改：旧 → 新
   - 修改的原则列表（旧标题 → 新标题如果重命名）
   - 添加的部分
   - 删除的部分
   - 需要更新的模板（✅ 已更新 / ⚠ 待处理）及文件路径
   - 如果有任何有意推迟的占位符，则后续 TODO。

6. 最终输出前验证：
   - 没有剩余未解释的大括号标记。
   - 版本行与报告匹配。
   - 日期 ISO 格式 YYYY-MM-DD。
   - 原则是声明式的、可测试的，没有模糊语言（避免"应该"、"可以"等模糊词 → 在适当的地方用 必须/推荐 并附理由替换）。

7. 将完成的宪章写回 `/memory/constitution.md`（覆盖）。

8. 向用户输出最终摘要：
   - 新版本和升级理由。
   - 任何需要人工跟进的文件。
   - 建议的提交消息（例如，`docs: 将宪章修订为 vX.Y.Z（原则新增 + 治理更新）`）。

格式化和样式要求：

- 严格套用模板中的Markdown标题（不要降级/升级层级）。
- 包裹长理由行以保持可读性（理想情况下 <100 个字符），但不要通过生硬的换行强制断行。
- 各部分之间保留一个空行。
- 避免行尾空格。

如果用户提供部分更新（例如，仅一个原则修订），仍然执行验证和版本决策步骤。

如果关键信息缺失（例如，批准日期确实未知），插入 `TODO(<FIELD_NAME>): 解释` 并将其包含在同步影响报告中的推迟项目下。

不要创建新模板；始终操作现有 `/memory/constitution.md` 文件。
