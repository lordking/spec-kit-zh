---
description: 根据用户交互或提供输入的原则创建或更新项目宪章，确保所有依赖的模板保持同步。
handoffs:
  - label: 构建规格
    agent: speckit.specify
    prompt: 基于更新后的宪章实现功能规格。我想构建...
---

## 用户输入

```text
$ARGUMENTS
```

（如果不为空）在进行之前，你**必须**考虑用户输入。

## 大纲

你正在更新位于 `/memory/constitution.md` 的项目宪章。此文件是一个模板，包含使用方括号作为占位符标记（例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）。你的工作是（a）收集/推导具体值，（b）精确填充模板，（c）将任何修改传播到依赖的工件中。

遵循如下执行流程：

1. 加载现有位于 `/memory/constitution.md` 的宪章模板。
   - 识别 `[ALL_CAPS_IDENTIFIER]` 形式的每个占位符标记。
   **重要**：用户可能需要的原则比模板中使用的更少或更多。如果明确指定了数量，请遵循通用模板调整。并相应地更新文档。

2. 收集/推导占位符的值：
   - 如果用户输入（对话）提供了一个值，请使用它。
   - 否则从现有仓库上下文（README、文档、或者之前嵌入的宪章版本）中推断。
   - 对于治理日期：`RATIFICATION_DATE` 是原始采用日期（如果未知请询问或标记 TODO），`LAST_AMENDED_DATE` 如果有修改则为今日，否则保留之前的日期。
   - `CONSTITUTION_VERSION` 必须根据语义化版本控制规则递增：
     - MAJOR：向后不兼容的治理/原则被删除或重新定义。
     - MINOR：新增原则/章节或指导内容实质性的扩展。
     - PATCH：澄清、措辞修正、拼写修正、非语义性改进。
   - 如果版本升级类型不明确，请在最终确定前提出理由。

3. 起草更新的宪章内容：
   - 用具体文本替换每个占位符（不得保留任何方括号标记的占位符，除非是项目有意保留的、尚未定义的模板槽位——对此必须明确说明理由）。
   - 保持标题层级结构，替换后可移除注释（除非注释仍提供明确指引）。
   - 确保每个原则/章节：简洁的名称、段落（或项目列表）捕获不可协商的规则。若规则不明确则需明确说明理由。
   - 确保治理章节列出修正程序、版本控制策略和合规审查期望。

4. 一致性传播检查（将之前的检查清单转换为主动验证）：
   - 读取 `/templates/plan-template.md` ，确保"宪章检查"章节的任何内容或规则与更新后的原则对齐。
   - 读取 `/templates/spec-template.md` ，确保范围/需求对齐 - 如果项目宪章新增/删除了强制性的章节或约束，则更新。
   - 读取 `/templates/tasks-template.md` ，确保任务分类反映新增或者删除的原则导向性的任务类型（例如可观测性、版本控制、测试规范）。
   - 读取 `/templates/commands/*.md` 中的每个命令文件（包括此文件），验证在需要通用指导时没有过时的引用（仅限于代理特定的名称，例如 CLAUDE）。
   - 读取任何运行时的指导文档（例如`README.md`、`docs/quickstart.md`，或存在的代理指定的指导文件），然后更新有关已更改原则的引用。

5. 生成同步影响报告（在宪章文件更新后，将其作为 HTML 注释添加至文件顶部）：
   - 版本更改：旧版本 → 新版本
   - 已修改的原则列表（如果重命名，请注明旧标题 → 新标题）
   - 新增的章节
   - 删除的章节
   - 需要更新的模板（✅ 已更新 / ⚠ 待处理）及文件路径
   - 后续待处理的 TODO 项（如果存在故意延期处理的占位符）

6. 最终输出前验证：
   - 没有剩余未解释的方括号标记。
   - 版本行与报告匹配。
   - ISO 日期格式 YYYY-MM-DD。
   - 原则是声明式的、可测试的，没有模糊语言（避免"应该"、"可以"等模糊词 → 在适当的地方替换为 必须/推荐 并说明理由）。

7. 将完成的宪章写回 `/memory/constitution.md`（覆盖）。

8. 向用户输出最终摘要：
   - 新版本和升级理由。
   - 任何需要人工跟进的文件。
   - 建议的提交消息（例如，`文档: 将宪章修订为 vX.Y.Z（新增原则 + 更新治理）`）。

格式和样式要求：

- 严格套用模板中的Markdown标题（不要降级/升级层级）。
- 对过长的说明文本进行换行，以保持可读性（建议每行不超过100个字符），但避免生硬的断行导致不自然的断句。
- 各章节之间保留一个空行。
- 避免行尾空格。

如果用户提供了部分更新（例如，仅修订了一个原则），仍应执行验证和版本决策步骤。

如果关键信息缺失（例如，批准日期确实未知），插入 `TODO(<FIELD_NAME>): 解释` 并将其包含在同步影响报告中的待处理项目下。

不要创建新模板；始终操作现有 `/memory/constitution.md` 文件。
